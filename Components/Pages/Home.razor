@page "/"

@attribute [StreamRendering]

@inject IJokeService _jokeService

<FluentStack Orientation="Orientation.Vertical" HorizontalAlignment="HorizontalAlignment.Center">

    <FluentLabel>Welcome to Onerdy's Dad Jokes website!</FluentLabel>
    <br />

    @if (randomJoke == null)
    {
        <FluentProgressRing />
        <FluentLabel>Loading jokes...</FluentLabel>
    }

    else
    {
        @* Using Blazor EditForm with Enhance to get basic interactivity
            without needing SignalR WebSockets*@

        <EditForm FormName="JokeForm" Model="@randomJoke" OnSubmit="@LoadRandomJoke" Enhance>
            <FluentStack Orientation="Orientation.Vertical" HorizontalAlignment="HorizontalAlignment.Center">
                <FluentCard Width="300px" Height="200px">
                    <FluentLabel Weight="FontWeight.Bold">@randomJoke?.Question</FluentLabel>
                    <br />
                    <FluentLabel>@randomJoke?.Answer </FluentLabel>
                </FluentCard>
                <FluentButton IconStart="@(new Icons.Regular.Size16.ArrowRepeatAll())" Type="ButtonType.Submit">Load Random Joke</FluentButton>
            </FluentStack>
        </EditForm>
    }
</FluentStack>

@code {
    private IEnumerable<Joke>? jokes;
    private Joke? randomJoke;

    protected override async Task OnInitializedAsync()
    {
        jokes = await _jokeService.GetAllJokes();
        LoadRandomJoke();
    }

    private void LoadRandomJoke()
    {
        Random rnd = new Random();

        randomJoke = jokes?.ElementAt<Joke>(rnd.Next(0, jokes.Count()));

    }
}